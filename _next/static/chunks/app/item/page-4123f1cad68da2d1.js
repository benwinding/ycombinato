(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{3510:function(e,t,n){Promise.resolve().then(n.bind(n,2138))},2138:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return L}});var r,l,s=n(9268),a=n(6006);let i=async e=>fetch("https://hn.algolia.com/api/v1/items/".concat(e)).then(e=>e.json()),o=()=>{let[e,t]=a.useState();return a.useEffect(()=>{let e=window.location.search,n=new URLSearchParams(e);t(n)},[]),e};var c=n(4824),u=n(9829),d=n(8550);let h=new c.QueryClient({defaultOptions:{queries:{cacheTime:36e5}}}),m=(0,u.O)({storage:(()=>{try{return window.localStorage}catch(e){return null}})()});(0,d.w)({queryClient:h,persistor:m,maxAge:36e5,hydrateOptions:{},dehydrateOptions:{}});var x=n(6902),f=n.n(x),p=n(3432),g=n.n(p),v=n(7593);f().extend(g());let b=e=>(0,s.jsx)("div",{className:"font-sans",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("a",{href:e.submissionLink,target:"_blank",referrerPolicy:"no-referrer",className:"hover:underline",children:(0,s.jsxs)("h1",{className:"text-xl flex items-center gap-2",children:[(0,s.jsx)(v.Z,{width:20})," ",e.title]})}),e.comments.map(t=>(0,s.jsx)(y,{comment:t,filterText:e.filterText},t.id))]})}),y=e=>{let[t,n]=(0,a.useState)(!1),{comment:r,filterText:l}=e,i=r._textMarked||r.text||"<i>[deleted]<i/>",o=!r._textMarked;a.useEffect(()=>{n(!!l&&o)},[r.id,l,o]);let c=a.useCallback(()=>n(!0),[]),u=a.useCallback(()=>n(!1),[]);return(0,s.jsx)(j,{id:r.id,html:i,comments:r.children,isCollapsed:t,header:(0,s.jsx)(C,{comment:r,isCollapsed:t,onCollapse:c,onExpand:u}),filterText:l})};function j(e){let{comments:t,isCollapsed:n,filterText:r,html:l}=e;return(0,s.jsxs)("ul",{className:"list-decimal bg-black bg-opacity-5 rounded pl-2",children:[(0,s.jsxs)("div",{id:e.id+"",children:[e.header,!n&&(0,s.jsx)("div",{className:"text-xs py-1 pr-2",dangerouslySetInnerHTML:{__html:l}})]}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:t.map(e=>(0,s.jsx)(y,{comment:e,filterText:r},e.id))})]})}function C(e){var t;let{comment:n,isCollapsed:r,onExpand:l,onCollapse:i}=e,o=a.useCallback(()=>{r?l():i()},[r,i,l]),c="https://news.ycombinator.com/item?id=".concat(n.id),u="https://news.ycombinator.com/user?id=".concat(n.author);return(0,s.jsxs)("div",{className:"flex items-center gap-2 text-gray-500 text-xs pt-1",children:[(0,s.jsx)("a",{className:"hover:underline",href:u,target:"_blank",referrerPolicy:"no-referrer",children:n.author}),(0,s.jsx)("a",{className:"hover:underline ",href:c,target:"_blank",referrerPolicy:"no-referrer",children:(t=n.created_at,f()(t).fromNow())}),(0,s.jsxs)("button",{style:{marginTop:-2},onClick:o,children:["[",r?"+":"-","]"]})]})}let k=a.memo(function(){return(0,s.jsx)(c.QueryClientProvider,{client:h,children:(0,s.jsx)(N,{})})}),N=()=>{let[e,t]=a.useState("Sort by response count"),[n,r]=a.useState(""),l=o(),u=null==l?void 0:l.get("id"),d=(0,c.useQuery)("post"+u,()=>i(u+""),{enabled:null!=u}),[h,m]=function(e,t){let[n,r]=(0,a.useState)(e),[l,s]=(0,a.useState)(!1);return(0,a.useEffect)(()=>{s(!0);let n=setTimeout(()=>{r(e),s(!1)},t);return()=>{clearTimeout(n)}},[e,t]),[n,l]}(n,400),x=d.data,f=w(x,e),p=function(e,t){let n=(0,a.useMemo)(()=>{if(e)return function(e,t){let n={...e},r=n.children.reduce((e,n)=>{let r=function e(t,n){let r=0;if(n){let e=function(e,t){var n;let r=RegExp(t.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&"),"ig"),l=(null===(n=e.match(r))||void 0===n?void 0:n.length)||0;if(!l)return{htmlNew:void 0,numReplacements:l};let s=e.replaceAll(r,"<mark>$&</mark>");return{htmlNew:s,numReplacements:l}}(t.text||"",n);r+=e.numReplacements,t._textMarked=e.htmlNew}else t._textMarked=void 0;return t.children.forEach(t=>{r+=e(t,n)}),r}(n,t);return e+r},0);return{data:n,markCount:r}}(e,t)},[e,t]);return n}(f,h),g=_(null==p?void 0:p.data,h),v=null==p?void 0:p.markCount;return(0,s.jsxs)("div",{className:"flex flex-col py-1 px-2",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(E,{onChange:t,value:e}),(0,s.jsx)(T,{onChange:r,value:n}),null!=v&&(0,s.jsx)(S,{count:v,loading:m})]}),d.isLoading&&d.isFetching&&(0,s.jsx)("div",{children:"Loading..."}),g]})};function S(e){return e.loading?(0,s.jsx)("div",{children:"Searching..."}):(0,s.jsxs)("div",{children:["Found ",e.count," results"]})}let _=(e,t)=>{let n=(0,a.useMemo)(()=>e&&(0,s.jsx)(b,{submissionLink:e.url,title:e.title,comments:e.children,filterText:t}),[e,t]);return n},w=(e,t)=>{let n=(0,a.useMemo)(()=>e?function(e,t){if(!e)return e;let n={...e};if(t.byThreadDepth){let e=(t,n)=>{let r=n.children||[];if(!r.length)return t;let l=r.reduce((n,r)=>{let l=e(t+1,r);return l>n?l:n},0);return l},t=(t,n)=>e(0,n)-e(0,t),r=e=>(e.children.sort(t),e.children.forEach(e=>{r(e)}),e.children);console.time("sort byThreadDepth"),n.children=r(n),console.timeEnd("sort byThreadDepth")}return t.byResponseCount&&(console.time("sort byResponseCount"),n.children=n.children.sort((e,t)=>t.children.length-e.children.length),console.timeEnd("sort byResponseCount")),n}(e,{byResponseCount:"Sort by response count"===t,byThreadDepth:"Sort by thread length"===t}):void 0,[e,t]);return n};function T(e){return(0,s.jsx)("input",{className:"border rounded-md px-1",placeholder:"Filter comments...",onChange:t=>e.onChange(t.target.value),value:e.value})}function E(e){return(0,s.jsx)("div",{className:"flex items-center gap-2",children:["Sort by response count","Sort by thread length"].map(t=>(0,s.jsx)(M,{value:t,label:t,checked:t===e.value,onChange:n=>e.onChange(t)},t))})}function M(e){let{label:t,value:n,checked:r,onChange:l}=e;return(0,s.jsxs)("label",{className:"text-xs flex items-center gap-1",children:[(0,s.jsx)("input",{type:"radio",value:n,checked:r,onChange:l}),t]})}(r=l||(l={})).byResponseCount="Sort by response count",r.byThreadDepth="Sort by thread length";let R=()=>{let[e,t]=a.useState(!1);a.useEffect(()=>{t(!0)},[]);let n=a.useMemo(()=>e?(0,s.jsx)(k,{}):null,[e]);return n};var L=R}},function(e){e.O(0,[619,667,139,744],function(){return e(e.s=3510)}),_N_E=e.O()}]);