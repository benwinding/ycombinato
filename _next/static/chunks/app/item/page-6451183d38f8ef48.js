(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{5064:function(e,t,n){Promise.resolve().then(n.bind(n,6185))},7862:function(e,t,n){"use strict";n.d(t,{E:function(){return l}});var r=n(9077),s=n(988),i=n(1821);let l=new r.QueryClient({defaultOptions:{queries:{cacheTime:36e5}}}),a=(0,s.O)({storage:(()=>{try{return window.localStorage}catch(e){return null}})()});(0,i.w)({queryClient:l,persistor:a,maxAge:36e5,hydrateOptions:{},dehydrateOptions:{}})},6185:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return page}});var r=n(7437),s=n(2265),i=n(9077);function superNaiveDeepClone(e){return JSON.parse(JSON.stringify(e))}function sortChildren(e,t){if(!e)return e;let n=superNaiveDeepClone(e),recursiveSort=(e,n)=>(e.children.sort(n),e.children.forEach((r,s)=>{var i,l;{let n=e.children[s+1];null!=n&&(null===(i=t.onNextFound)||void 0===i||i.call(t,r,n))}{let n=e.children[s-1];null!=n&&(null===(l=t.onPrevFound)||void 0===l||l.call(t,r,n))}recursiveSort(r,n)}),e.children);console.time("sort timer");let r=getSortFunction(t);return n.children=recursiveSort(n,r),console.timeEnd("sort timer"),n}function getSortFunction(e){return e.byThreadDepth?sortbyThreadDepthFn:(e.byResponseCount,sortByResponseCount)}let getDeepestChildLevel=(e,t)=>{let n=t.children||[];if(!n.length)return e;let r=n.reduce((t,n)=>{let r=getDeepestChildLevel(e+1,n);return r>t?r:t},0);return r},sortbyThreadDepthFn=(e,t)=>getDeepestChildLevel(0,t)-getDeepestChildLevel(0,e),sortByResponseCount=(e,t)=>t.children.length-e.children.length;function useDebounce(e,t){let[n,r]=(0,s.useState)(e),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{l(!0);let n=setTimeout(()=>{r(e),l(!1)},t);return()=>{clearTimeout(n)}},[e,t]),[n,i]}function useDataFiltered(e,t){let n=(0,s.useMemo)(()=>{if(e)return markAndCountChildren(e,t)},[e,t]);return n}function markAndCountChildren(e,t){let n={...e},r=n.children.reduce((e,n)=>{let r=recursiveMarkAndCountChildren(n,t);return e+r},0);return{data:n,markCount:r}}function recursiveMarkAndCountChildren(e,t){let n=0;if(t){let r=markTheHtml(e.text||"",t);n+=r.numReplacements,e._textMarked=r.htmlNew}else e._textMarked=void 0;return e.children.forEach(e=>{n+=recursiveMarkAndCountChildren(e,t)}),n}function markTheHtml(e,t){let n=document.createElement("div");n.innerHTML=e;let r=getTextNodes(n),s=0;return r.forEach(e=>{let n=RegExp(escapeRegex(t),"ig"),r=e.parentNode,i=e.textContent.replace(n,e=>(s++,"<mark>".concat(e,"</mark>"))),l=document.createElement("span");l.innerHTML=i,r.replaceChild(l,e)}),{htmlNew:s>0?n.innerHTML:void 0,numReplacements:s}}function getTextNodes(e){let t=[];function traverse(e){e.nodeType===Node.TEXT_NODE?t.push(e):e.childNodes.forEach(e=>traverse(e))}return traverse(e),t}function escapeRegex(e){return e.replace(/[/\-\\^$*+?.()|[\]{}]/g,"\\$&")}var l=n(1170),a=n(6750);let CommentResults=e=>{let t=e.story.children;return(0,r.jsx)("div",{className:"font-sans",children:(0,r.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,r.jsx)(DiscussionHeader,{story:e.story,commentCount:e.commentCount,filterOptions:e.filterOptions}),t.map(t=>(0,r.jsx)(CommentCard,{comment:t,maps:e.maps,filterText:e.filterText},t.id))]})})};function DiscussionHeader(e){let{story:t,commentCount:n,filterOptions:s}=e,i=t.title,o=(0,r.jsx)(l.It,{discussionId:t.id,className:"text-xs flex-shrink-0",children:"(read on hn)"}),u=null!=t.parent_id&&(0,r.jsx)(a.oo,{discussionId:t.parent_id,children:"parent comment"}),c=i&&(0,r.jsx)(l.dL,{href:t.url,children:(0,r.jsx)("h1",{className:"text flex items-center gap-2",children:i})});return(0,r.jsxs)("div",{className:"flex flex-col text-gray-700",children:[c&&(0,r.jsxs)("div",{className:"flex flex-col tiny:flex-row gap-2 items-center justify-between",children:[c,o]}),(0,r.jsxs)("div",{className:"text-xs flex justify-between",children:[(0,r.jsxs)("div",{children:[t.points," points by ",(0,r.jsx)(l.Av,{author:t.author}),(0,r.jsx)(Space,{}),(0,r.jsx)(l.iR,{discussionId:t.id,createdAt:t.created_at}),(0,r.jsx)(Bar,{}),n," comments"]}),u&&(0,r.jsxs)("div",{children:[u,(0,r.jsx)(Bar,{}),o]})]}),t.text&&(0,r.jsx)(HTMLOutput,{className:"text-xs pt-2",html:t.text}),(0,r.jsx)("div",{className:"border border-gray-300 p-2 rounded mt-1",children:s})]})}function Bar(){return(0,r.jsx)("span",{className:"px-1",children:"|"})}function Space(){return(0,r.jsx)("span",{className:"px-1"})}let CommentCard=e=>{let{comment:t,filterText:n,maps:s}=e,i=t._textMarked||t.text||"<i>[deleted]<i/>",l=s.idTotalMap.get(t.id)||0,a=useTextCollapse(t._textMarked,n),o=useThreadCollapse(n,l);return(0,r.jsx)(CommentCardContent,{id:t.id,html:i,comments:t.children,maps:s,isTextCollapsed:a.isCollapsed,isThreadCollapsed:o.isCollapsed,header:(0,r.jsx)(CommentHeader,{comment:t,maps:s,expanderThread:(0,r.jsx)(Expander,{...o}),expanderText:(0,r.jsx)(Expander,{...a})}),filterText:n})};function CommentCardContent(e){let{id:t,comments:n,header:s,isTextCollapsed:i,isThreadCollapsed:l,filterText:a,html:o}=e;return(0,r.jsxs)("ul",{className:"list-decimal bg-black bg-opacity-3 rounded pl-1 sm:pl-2",children:[(0,r.jsxs)("div",{id:t+"",children:[s,!(l||i)&&(0,r.jsx)(HTMLOutput,{className:"text-xs pr-2",html:o})]}),!l&&(0,r.jsx)("div",{className:"flex flex-col gap-2",children:n.map(t=>(0,r.jsx)(CommentCard,{comment:t,maps:e.maps,filterText:a},t.id))})]})}function HTMLOutput(e){return(0,r.jsx)("div",{className:e.className+" comment-text",dangerouslySetInnerHTML:{__html:e.html}})}function CommentHeader(e){let{comment:t,maps:n,expanderThread:i,expanderText:a}=e,o=n.idRootMap.get(t.id),u=n.idPrevMap.get(t.id),c=n.idNextMap.get(t.id),d=n.idParentMap.get(t.id),m=[{link:o,label:"root"},{link:d,label:"parent"},{link:u,label:"prev"},{link:c,label:"next"}].filter(e=>{let{link:t}=e;return null!=t}),h=m.map((e,t)=>{let{link:n,label:i}=e;return(0,r.jsxs)(s.Fragment,{children:[(0,r.jsx)("a",{href:"#"+n,children:i}),t<m.length-1&&(0,r.jsx)(Bar,{})]},t)});return(0,r.jsxs)("div",{className:"text-gray-500 text-xs",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 py-1",children:[(0,r.jsx)(l.Av,{className:"flex-shrink-0",author:t.author}),(0,r.jsx)(l.iR,{className:"line-clamp-1",discussionId:t.id,createdAt:t.created_at}),(0,r.jsx)("div",{className:"flex-shrink-0",children:i}),(0,r.jsx)("div",{className:"flex-grow"}),(0,r.jsx)("div",{className:"hidden xs:flex justify-end flex-wrap gap-0",children:h}),(0,r.jsx)("div",{className:"flex-shrink-0 pr-2",children:a})]}),(0,r.jsx)("div",{className:"flex xs:hidden gap-0",children:h})]})}function useThreadCollapse(e,t){let[n,r]=(0,s.useState)(!1);s.useEffect(()=>{e&&r(!1)},[e]);let i=s.useCallback(()=>r(!0),[]),l=s.useCallback(()=>r(!1),[]);return{expanderText:n?t&&t>1?"".concat(t," more"):"+":"-",isCollapsed:n,onCollapse:i,onExpand:l}}function useTextCollapse(e,t){let[n,r]=(0,s.useState)(!1),i=!e;s.useEffect(()=>{let e=!!t;r(e&&i)},[t,i]);let l=s.useCallback(()=>r(!0),[]),a=s.useCallback(()=>r(!1),[]);return{expanderText:n?"+":"-",isCollapsed:n,onCollapse:l,onExpand:a}}function Expander(e){let{isCollapsed:t,expanderText:n,onExpand:i,onCollapse:l}=e,a=s.useCallback(()=>{t?i():l()},[t,l,i]);return(0,r.jsxs)("button",{onClick:a,children:["[",n,"]"]})}var o=n(2466),u=n(1983),c=n(7862);function useHnPost(e){let t=(0,i.useQuery)("post-"+e,()=>fetchHackerNewsPost(e+""),{enabled:null!=e});return t}let fetchHackerNewsPost=async e=>{let t="https://hn.algolia.com/api/v1/items/".concat(e);return fetch(t).then(e=>e.json())};var d=n(4033),m=n(3107);let PostViewerWrapper=()=>(0,r.jsx)(i.QueryClientProvider,{client:c.E,children:(0,r.jsx)(PostViewer,{})}),PostViewer=()=>{let[e,t]=s.useState("Sort by response count"),[n,i]=s.useState(""),l=(0,d.useSearchParams)(),a=l.get("id"),o=useHnPost(a+""),[c,m]=useDebounce(n,1e3),h=o.data,x=new Map,f=new Map,p=useDataSort(h,e,x,f),v=s.useMemo(()=>getCommentCount(h),[h]),g=useDataFiltered(p,c),N=null==g?void 0:g.markCount,j=(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,r.jsx)(SortOptions,{onChange:t,value:e}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"flex-grow",children:(0,r.jsx)(FilterText,{onChange:i,value:n})}),(0,r.jsx)("div",{className:"flex-shrink-0",children:null!=N&&(0,r.jsx)(FilterResultsCount,{count:N,loading:m,filterText:n})})]})]}),C=useResults(null==g?void 0:g.data,c,{...v,idNextMap:x,idPrevMap:f},j);return(0,r.jsxs)("div",{className:"flex flex-col py-1 px-2",children:[o.isLoading&&o.isFetching&&(0,r.jsx)(u.a,{}),C]})};function FilterResultsCount(e){return e.filterText?e.loading?(0,r.jsx)("div",{children:"Searching..."}):(0,r.jsxs)("div",{children:["Found ",e.count," results"]}):(0,r.jsx)("div",{className:"w-20"})}function getCommentCount(e){let t=0,n=new Map,r=new Map,s=new Map;if(!e)return{totalComments:t,idTotalMap:n,idRootMap:r,idParentMap:s};let getChildrenRecursively=(e,i)=>{let l=0,a=void 0===i;return e.children.forEach((o,u)=>{{t++;let e=a?o.id:i,r=1+getChildrenRecursively(o,e);l+=r,n.set(o.id,r)}a||s.set(o.id,e.id),null!=i&&r.set(o.id,i)}),l};return getChildrenRecursively(e,void 0),{totalComments:t,idTotalMap:n,idRootMap:r,idParentMap:s}}let useResults=(e,t,n,i)=>{let l=(0,s.useMemo)(()=>e&&(0,r.jsx)(CommentResults,{story:e,filterText:t,commentCount:n.totalComments,maps:{idTotalMap:n.idTotalMap,idRootMap:n.idRootMap,idParentMap:n.idParentMap,idNextMap:n.idNextMap,idPrevMap:n.idPrevMap},filterOptions:i}),[e,t,n,i]);return l},useDataSort=(e,t,n,r)=>{let i=(0,s.useMemo)(()=>{if(e)return sortChildren(e,{byResponseCount:"Sort by response count"===t,byThreadDepth:"Sort by thread length"===t,onNextFound:(e,t)=>n.set(e.id,t.id),onPrevFound:(e,t)=>r.set(e.id,t.id)})},[e,n,r,t]);return i};function FilterText(e){return(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("input",{className:"border rounded-md px-1 w-full",placeholder:"Filter comments...",onChange:t=>e.onChange(t.target.value),value:e.value}),(0,r.jsx)("button",{onClick:()=>e.onChange(""),className:"-ml-6 text-gray-400",children:(0,r.jsx)(o.Z,{width:20})})]})}function SortOptions(e){return(0,r.jsx)("div",{className:"flex items-center gap-2",children:["Sort by response count","Sort by thread length"].map(t=>(0,r.jsx)(m.E,{value:t,label:t,checked:t===e.value,onChange:n=>e.onChange(t)},t))})}var h=n(1358),page=()=>{let e=(0,h.t)(),t=s.useMemo(()=>e?(0,r.jsx)(PostViewerWrapper,{}):null,[e]);return t}},1170:function(e,t,n){"use strict";n.d(t,{Av:function(){return LinkToAuthor},It:function(){return LinkToDiscussionWrapper},dL:function(){return ExternalLink},iR:function(){return LinkToDiscussion}});var r=n(7437),s=n(7766);function ExternalLink(e){return(0,r.jsx)("a",{href:e.href,target:"_blank",referrerPolicy:"no-referrer",className:"hover:underline "+e.className,children:e.children})}function LinkToAuthor(e){let t="https://news.ycombinator.com/user?id=".concat(e.author);return(0,r.jsx)(ExternalLink,{href:t,className:e.className,children:e.author})}function LinkToDiscussion(e){return(0,r.jsx)(LinkToDiscussionWrapper,{discussionId:e.discussionId,className:e.className,children:(0,s._)(e.createdAt)})}function LinkToDiscussionWrapper(e){let t="https://news.ycombinator.com/item?id=".concat(e.discussionId);return(0,r.jsx)(ExternalLink,{href:t,className:e.className,children:e.children})}n(2265)},6750:function(e,t,n){"use strict";n.d(t,{C2:function(){return ILinkToDiscussion},h$:function(){return InternalLink},oo:function(){return ILinkToDiscussionWrapper}});var r=n(7437),s=n(7766),i=n(1396),l=n.n(i);function InternalLink(e){return(0,r.jsx)(l(),{href:e.href,className:"hover:underline "+e.className,children:e.children})}function ILinkToDiscussion(e){return(0,r.jsx)(ILinkToDiscussionWrapper,{discussionId:e.discussionId,className:e.className,children:(0,s._)(e.createdAt)})}function ILinkToDiscussionWrapper(e){let t="/item?id=".concat(e.discussionId);return(0,r.jsx)(InternalLink,{href:t,className:e.className,children:e.children})}n(2265)},3107:function(e,t,n){"use strict";n.d(t,{E:function(){return RadioButton}});var r=n(7437);function RadioButton(e){let{label:t,value:n,checked:s,onChange:i}=e;return(0,r.jsxs)("label",{className:"text-xs flex items-center gap-1",children:[(0,r.jsx)("input",{type:"radio",value:n,checked:s,onChange:i}),t]})}},1983:function(e,t,n){"use strict";n.d(t,{a:function(){return LoadingScreen}});var r=n(7437),s=n(2265);let i=["⊖_⊖","⊜_⊜","⊙_⊙"];function LoadingScreen(){let[e,t]=s.useState(0);return useTimeout(()=>{let n=(e+1)%i.length;t(n)},2e3*Math.random()),(0,r.jsxs)("div",{className:"flex flex-col items-center py-40 w-full",children:[(0,r.jsx)("p",{className:"text-3xl font-mono text-gray-600 pb-10",children:"Loading..."}),(0,r.jsx)("p",{className:"text-4xl font-mono whitespace-pre text-gray-400",children:i[e]})]})}function useTimeout(e,t){s.useEffect(()=>{let n=setTimeout(()=>{e()},t);return()=>{clearTimeout(n)}},[e,t])}},7766:function(e,t,n){"use strict";n.d(t,{_:function(){return getFromNowStr},q:function(){return Time}});var r=n(4548),s=n.n(r),i=n(6537),l=n.n(i);function getFromNowStr(e){return s()(e).fromNow()}s().extend(l());let Time=class Time{static fromIso(e){let t=Number(s()(e.dateIso).toDate());return new Time(t)}static fromHn(e){return new Time(1e3*e.seconds)}static fromDateString(e){let t=Number(s()(e.dateString,"YYYY-MM-DD").toDate());return new Time(t)}static fromDateObj(e){let t=Number(s()(e.dateObj).toDate());return new Time(t)}static now(){let e=Number(s()(new Date).toDate());return new Time(e)}formatAsHnSeconds(){return Math.round(this.ms/1e3)}formatFromNow(){return s()(this.ms).fromNow()}formatAsDateString(){return s()(this.ms).format("YYYY-MM-DD")}endOfDay(){let e=s()(this.ms).set("hours",23).set("minutes",59).set("seconds",59);return this.ms=Number(e.toDate()),this}startOfDay(){let e=s()(this.ms).set("hours",0).set("minutes",0).set("seconds",1);return this.ms=Number(e.toDate()),this}subtract1Day(){return this.ms=Number(s()(this.ms).subtract(24,"hours").toDate()),this}add1Day(){return this.ms=Number(s()(this.ms).add(24,"hours").toDate()),this}constructor(e){this.ms=e}}},1358:function(e,t,n){"use strict";n.d(t,{t:function(){return useIsMounted}});var r=n(2265);function useIsMounted(){let[e,t]=r.useState(!1);return r.useEffect(()=>{t(!0)},[]),e}},1396:function(e,t,n){e.exports=n(8326)},2466:function(e,t,n){"use strict";var r=n(2265);function XCircleIcon({title:e,titleId:t,...n},s){return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":t},n),e?r.createElement("title",{id:t},e):null,r.createElement("path",{fillRule:"evenodd",d:"M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25zm-1.72 6.97a.75.75 0 10-1.06 1.06L10.94 12l-1.72 1.72a.75.75 0 101.06 1.06L12 13.06l1.72 1.72a.75.75 0 101.06-1.06L13.06 12l1.72-1.72a.75.75 0 10-1.06-1.06L12 10.94l-1.72-1.72z",clipRule:"evenodd"}))}let s=r.forwardRef(XCircleIcon);t.Z=s}},function(e){e.O(0,[326,244,971,472,744],function(){return e(e.s=5064)}),_N_E=e.O()}]);