(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[269],{3510:function(e,t,n){Promise.resolve().then(n.bind(n,2208))},2208:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return S}});var r,l,s=n(9268),o=n(6006);let a=async e=>fetch("https://hn.algolia.com/api/v1/items/".concat(e)).then(e=>e.json()),c=()=>{let[e,t]=o.useState();return o.useEffect(()=>{let e=window.location.search,n=new URLSearchParams(e);t(n)},[]),e};var i=n(4824),u=n(9829),d=n(8550);let h=new i.QueryClient({defaultOptions:{queries:{cacheTime:36e5}}}),m=(0,u.O)({storage:(()=>{try{return window.localStorage}catch(e){return null}})()});(0,d.w)({queryClient:h,persistor:m,maxAge:36e5,hydrateOptions:{},dehydrateOptions:{}});let p=o.memo(function(){return(0,s.jsx)(i.QueryClientProvider,{client:h,children:(0,s.jsx)(x,{})})}),x=()=>{let[e,t]=o.useState("Sort by response count"),[n,r]=o.useState(""),l=c(),u=null==l?void 0:l.get("id"),d=(0,i.useQuery)("post"+u,()=>a(u+""),{enabled:null!=u}),h=function(e,t){let[n,r]=(0,o.useState)(e);return(0,o.useEffect)(()=>{let n=setTimeout(()=>{r(e)},t);return()=>{clearTimeout(n)}},[e,t]),n}(n,1e3),m=d.data,p=g(m,e),x=function(e,t){let n=(0,o.useMemo)(()=>e?t?(console.log("marking..."),function(e,t){let n={...e},r=n.children.reduce((e,n)=>{let r=function e(t,n){let r=0;return t.children.forEach(t=>{let l=function(e,t){var n;let r=RegExp(t,"gi"),l=e.replaceAll(t,"<mark>$&</mark>"),s=(null===(n=e.match(r))||void 0===n?void 0:n.length)||0;return{htmlNew:l,numReplacements:s}}(t.text||"",n);r+=l.numReplacements,t.textMarked=l.htmlNew,r+=e(t,n)}),r}(n,t);return e+r},0);return{data:n,markCount:r}}(e,t)):{data:e,markCount:0}:void 0,[e,t]);return n}(p,h),b=f(null==x?void 0:x.data);return(0,s.jsxs)("div",{className:"flex flex-col py-1 px-2",children:[(0,s.jsxs)("div",{className:"flex gap-2",children:[(0,s.jsx)(y,{onChange:t,value:e}),(0,s.jsx)(v,{onChange:r,value:n}),"Found ",null==x?void 0:x.markCount," results"]}),d.isLoading&&d.isFetching&&(0,s.jsx)("div",{children:"Loading..."}),b]})},f=e=>{o.useEffect(()=>{console.log("data changed...")},[e]);let t=(0,o.useMemo)(()=>e&&(0,s.jsx)(j,{title:e.title,comments:e.children}),[e]);return t},g=(e,t)=>{let n=(0,o.useMemo)(()=>e?function(e,t){if(!e)return e;let n={...e};if(t.byThreadDepth){let e=(t,n)=>{let r=n.children||[];if(!r.length)return t;let l=r.reduce((n,r)=>{let l=e(t+1,r);return l>n?l:n},0);return l},t=(t,n)=>e(0,n)-e(0,t),r=e=>(e.children.sort(t),e.children.forEach(e=>{r(e)}),e.children);console.time("sort byThreadDepth"),n.children=r(n),console.timeEnd("sort byThreadDepth")}return t.byResponseCount&&(console.time("sort byResponseCount"),n.children=n.children.sort((e,t)=>t.children.length-e.children.length),console.timeEnd("sort byResponseCount")),n}(e,{byResponseCount:"Sort by response count"===t,byThreadDepth:"Sort by thread length"===t}):void 0,[e,t]);return n};function v(e){return(0,s.jsx)("input",{className:"border rounded-md",placeholder:"Filter comments...",onChange:t=>e.onChange(t.target.value),value:e.value})}function y(e){return(0,s.jsx)("div",{className:"flex items-center gap-2",children:["Sort by response count","Sort by thread length"].map(t=>(0,s.jsx)(b,{value:t,label:t,checked:t===e.value,onChange:n=>e.onChange(t)},t))})}function b(e){let{label:t,value:n,checked:r,onChange:l}=e;return(0,s.jsxs)("label",{className:"text-xs flex items-center gap-1",children:[(0,s.jsx)("input",{type:"radio",value:n,checked:r,onChange:l}),t]})}(r=l||(l={})).byResponseCount="Sort by response count",r.byThreadDepth="Sort by thread length";let j=e=>(0,s.jsx)("div",{className:"font-sans",children:(0,s.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,s.jsx)("h1",{className:"text-xl font-bold",children:e.title}),e.comments.map(e=>(0,s.jsx)(C,{comment:e},e.id))]})}),C=e=>{let{comment:t}=e,n=t.textMarked||t.text||"";return(0,s.jsxs)("ul",{className:"list-decimal bg-black bg-opacity-5 rounded pl-2",children:[(0,s.jsx)("div",{className:"",children:(0,s.jsx)("div",{className:"text-xs py-1 pr-2",dangerouslySetInnerHTML:{__html:n}})}),(0,s.jsx)("div",{className:"flex flex-col gap-2",children:t.children.map(e=>(0,s.jsx)(C,{comment:e},e.id))})]})},N=()=>{let[e,t]=o.useState(!1);o.useEffect(()=>{t(!0)},[]);let n=o.useMemo(()=>e?(0,s.jsx)(p,{}):null,[e]);return n};var S=N}},function(e){e.O(0,[303,667,139,744],function(){return e(e.s=3510)}),_N_E=e.O()}]);